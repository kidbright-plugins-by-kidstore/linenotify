# linenotify
ส่งข้อความ รูปภาพ สติ๊กเกอร์ ไปยังห้องแชทในแอพพลิเคชั่นไลน์ ด้วยบอร์ด KidBright32 โดยใช้ LINE Notify

ปลั๊กอินนี้จำเป็นต้องใช้อินเตอร์เน็ต ดังนั้นต้องตั้งค่าการเชื่อมต่อ WiFi ที่โปรแกรม KidBrightIDE ด้วย

ปลั๊กอินนี้ ใช้งานร่วมกับปลั๊กอิน theio ไม่ได้ ด้วยปัญหาทางเทคนิค (Task I/O Device กำหนดพื้นที่แรมมาน้อยไป ทำให้เมื่อใช้งานร่วมแล้วเกิดปัญหา WDT ทำงานเพราะ stack overflow)

### การติดตั้ง

 1. ดาวน์โหลดไฟล์ `linenotify_vx.x.zip`
 2. แตกไฟล์ออกมา จะได้โฟลเดอร์ linenotify
 3. ย้ายโฟลเดอร์ linenotify ไปไว้ในโฟลเดอร์ `C:\Users\[Username]\AppData\Local\KidBright\app-[version]\resources\app\kbide\plugins`
 4. เปิดโปรแกรม KidBrightIDE จะมีบล็อกให้เลือกเพิ่มแล้ว

### การใช้งาน

การใช้งาน LINE Notify ต้องเพิ่ม LINE Notify เป็นเพื่อนก่อน โดยสแกน QR Code ด้านล่างนี้

![](https://cz.lnwfile.com/_/cz/_raw/gk/ox/qd.png)

จากนั้นจึงขอ Access Token โดยตัว Access Token นี้จะเป็นตัวแทนที่ใช้กำหนดว่าจะให้ส่งการแจ้งเตือนไปที่ไหน

เข้าไปที่หน้าเว็บ https://notify-bot.line.me/my/ จากนั้นระบบจะให้ล็อกอินด้วยบัญชี LINE โดยกรอกอีเมล์ และรหัสผ่านที่ได้ตั้งไว้ลงไป

![](https://cz.lnwfile.com/_/cz/_raw/y1/mr/kp.png)

เมื่อล็อกอินสำเร็จแล้ว ให้เลื่อนลงมาด้านล่าง จะพบ *ออก Access Token (สำหรับผู้พัฒนา)* ให้กดปุ่ม ออก Token

![](https://cz.lnwfile.com/_/cz/_raw/od/7a/dk.png)

พอมาถึงส่วนนี้ให้เราทำความเข้าใจก่อนว่า เมื่อเราส่งข้อความไปแล้ว ข้อความที่ขึ้นจะปรากฏในรูปแบบ

\[ชื่อ Token\]: \[ข้อความ\]

ดังนั้นในช่องที่ 1 สามารถกรอกเป็นอะไรก็ได้ และสิ่งที่กรอกนั้นจะติดไปพร้อมกับข้อความเสมอ เช่น หากกรอกว่า KidBright เมื่อใช้ API ส่งข้อความว่า "สวัสดี" ข้อความจะขึ้นว่า "KidBright: สวัสดี"

ในช่องที่ 2 จะให้เลือกว่าจะให้ส่งข้อความเข้าไปในกลุ่มไหน หรือส่งให้ตัวเองเท่านั้น

เมื่อกรอกครบแล้ว ให้กดปุ่ม **ออก Token**

![](https://cz.lnwfile.com/_/cz/_raw/bi/7d/di.png)

เมื่อกดปุ่มแล้ว จะปรากฏรหัส Token มาให้**เพียงครั้งเดียว** ให้นำรหัสนี้ ไปใส่ลงในบล็อก ตั้งค่า Access Token เป็น (Set Access Token to) แล้วจึงใช้บล็อก ส่งการแจ้งเตือน เพื่อส่งข้อความไปยังไลน์อีกที

![](https://cz.lnwfile.com/_/cz/_raw/7e/af/sd.png)

*ที่มารูปภาพจาก : [ESP8266 / ESP8285 กับการส่งการแจ้งเตือนเข้า LINE](https://www.ioxhop.com/article/47/esp8266-esp8285-%E0%B8%81%E0%B8%B1%E0%B8%9A%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B8%AA%E0%B9%88%E0%B8%87%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B9%81%E0%B8%88%E0%B9%89%E0%B8%87%E0%B9%80%E0%B8%95%E0%B8%B7%E0%B8%AD%E0%B8%99%E0%B9%80%E0%B8%82%E0%B9%89%E0%B8%B2-line)*

#### บล็อก ตั้งค่า Access Token เป็น (Set Access Token to)

![](https://a.lnwpic.com/1n05e8.jpg)

ใช้ตั้งค่า Access Token ที่ได้จาก LINE Notify ให้นำบล็อกข้อความมาต่อ แล้วแก้ข้อความให้เป็น Access Token ที่ถูกต้อง

#### บล็อก ส่งการแจ้งเตือน (Sends notifications)

![](https://a.lnwpic.com/iqu2qt.jpg)

แต่ละช่องอินพุต (เขี้ยวที่บล็อกเข้ามาต่อได้) ต้องเป็นบล็อกข้อความทั้งหมด โดยมีรายละเอียดแต่ละอันดังนี้

 * ข้อความ (Message) - ข้อความที่ต้องการส่งแจ้งเตือน
 * Image Thumbnail - ลิ้งของรูปภาพที่ต้องการแนบไปด้วย เฉพาะรูปภาพที่มีขนาดไม่เกิน 240×240px และเป็นชนิด JPEG เท่านั้น
 * Image full size - ลิ้งของรูปภาพที่ต้องการแนบไปด้วย เฉพาะรูปภาพที่มีขนาดไม่เกิน 1024×1024px และเป็นชนิด JPEG เท่านั้น
 * Sticker Package Id - หมายเลขชุดของสติ๊กเกอร์ที่ต้องการส่งไปด้วย
 * Sticker Id - หมายเลขสติ๊กเกอร์ในชุดนั้นที่ต้องการส่ง

**ต้องใส่พารามิเตอร์ให้ครบทั้งหมดด้วยบล็อกข้อความ กรณีพารามิเตอร์ใดไม่ต้องการใช้ ไม่ต้องใส่ข้อความใด ๆ ลงในช่องนั้น (ดูตัวอย่างโปรแกรมประกอบ)**

ถ้าจะส่งรูปภาพ ต้องใส่ลิ้งรูปภาพลงใน Image Thumbnail และ Image full size กรณีต้องการส่งสติ๊กเกอร์ ต้องส่งทั้ง Sticker Package Id และ Sticker Id โดยรายการสติ๊กเกอร์ที่ส่งได้ ให้ดูจาก [Sticker List](https://devdocs.line.me/files/sticker_list.pdf) ให้เอาค่า STKID มาใส่ใน Sticker Id และ STKPKGID ใส่ใน Sticker Package Id

หากต้องการส่งเฉพาะข้อความ ให้ใส่เฉพาะช่อง ข้อความ (Message) ได้ ช่องอื่น ๆ ให้ใส่ข้อความว่าง ๆ ไว้

### ตัวอย่างโปรแกรม

![](https://a.lnwpic.com/mf98om.jpg)

### วิดีโอทดสอบการทำงาน

[![ส่งการแจ้งเตือนผ่านไลน์ ด้วยบอร์ด KidBright](https://img.youtube.com/vi/RYSF7UOAun0/0.jpg)](https://www.youtube.com/watch?v=RYSF7UOAun0)
